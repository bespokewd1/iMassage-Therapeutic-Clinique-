---
import BaseLayout from 'src/layouts/BaseLayout.astro';
import CTA from '@components/CTA.astro';
import Landing from '@components/Landing.astro';
import { getOptimizedImage } from '@js/utils';
import landingImage from '@assets/images/stone-massage-background1.png';
import { getCollection } from 'astro:content';
import { Image } from 'astro-lqip/components';

import { resolveImage } from '@js/imageUtils';
import type { GetImageResult } from 'astro';
import seoSetting from '@data/seo-pages.json';
const seo = seoSetting.home;
const ogImg = await resolveImage(seo.ogImage);
let ogImage: GetImageResult | null = null;
if (ogImg) {
  ogImage = await getOptimizedImage(ogImg);
}

const optimizedImage = await getOptimizedImage(landingImage);
const galleryItems = await getCollection('gallery');

const categories = [
  {
    id: 'inside-clinic',
    label: 'Inside Our Clinic',
  },
  {
    id: 'client-experience',
    label: 'Client Experience',
  },
  {
    id: 'events-specials',
    label: 'Events & Specials',
  },
];

const itemsByCategory = (catId: string) =>
  galleryItems.filter((item) => item.data.category === catId);
---

<BaseLayout
  title={seo.title || 'Gallery'}
  description={seo.description}
  ogImage={ogImage}
  preloadedImage={optimizedImage}
>
  <!-- ============================================ -->
  <!--                    LANDING                   -->
  <!-- ============================================ -->

  <Landing title="Gallery" image={optimizedImage} />

  <!-- ============================================ -->
  <!--                   Gallery                    -->
  <!-- ============================================ -->

  <section id="gallery" class="py-[2.5rem]">
    <!-- Tabs -->
    <div
      class="mb-10 flex flex-col items-center gap-y-4 sm:justify-center md:flex-row md:gap-x-8"
    >
      {
        categories.map((cat, index) => (
          <button
            id={`btn-${cat.id}`}
            class="tab-button cs-button-solid bg-gray-200"
            data-tab={cat.id}
            type="button"
          >
            {cat.label}
          </button>
        ))
      }
    </div>

    <!-- Tab contents -->
    {
      categories.map((cat, index) => {
        const catItems = itemsByCategory(cat.id);
        const isFirst = index === 0;
        return (
          <div
            id={cat.id}
            class:list={['cs-container tab-content', !isFirst && 'hidden']}
          >
            <h1 class="mb-4 md:text-4xl" style="text-transform: uppercase;">
              {cat.label}
            </h1>
            <div class="mb-8 w-full">
              <div class="flex flex-col items-center justify-center gap-4 lg:flex-row lg:flex-wrap">
                {catItems.length === 0 ? (
                  <p class="text-slate-600">
                    No images available yet in this category.
                  </p>
                ) : (
                  catItems.map(({ id, data }) => (
                    <Image
                      src={data.image}
                      alt={data.caption}
                      class="aspect-video w-full max-w-xs rounded-lg object-cover sm:max-w-sm md:max-w-md lg:max-w-lg"
                      loading="lazy"
                      decoding="async"
                    />
                  ))
                )}
              </div>
            </div>
            <a href="/contact" class="cs-button-solid">
              Get Free Quote
            </a>
          </div>
        );
      })
    }
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const categories = [
        'inside-clinic',
        'client-experience',
        'events-specials',
      ];

      function switchTab(tabId: string) {
        categories.forEach((id) => {
          const tab = document.getElementById(id);
          const btn = document.getElementById('btn-' + id);
          if (tab && btn) {
            tab.classList.add('hidden');
            btn.classList.remove('bg-[#f3117e]', 'text-white');
            btn.classList.add('bg-gray-200');
          }
        });

        const selectedTab = document.getElementById(tabId);
        const selectedBtn = document.getElementById('btn-' + tabId);
        if (selectedTab && selectedBtn) {
          selectedTab.classList.remove('hidden');
          selectedBtn.classList.remove('bg-gray-200');
          selectedBtn.classList.add('bg-[#f3117e]', 'text-white');
        }
      }

      // Attach event listeners
      ['inside-clinic', 'client-experience', 'events-specials'].forEach(
        (id) => {
          const btn = document.getElementById('btn-' + id);
          if (btn) {
            btn.addEventListener('click', () => switchTab(id));
          }
        }
      );

      // Set initial active tab
      switchTab('inside-clinic');
    });
  </script>

  <CTA
    title="Restore Balance. Feel Renewed"
    description="Expert therapeutic massage tailored to your needs."
  />
</BaseLayout>

<style lang="less">
  /* PAGE-SPECIFIC STYLES FOR THE PROJECTS PAGE */

  /*-- -------------------------- -->
<---          Gallery           -->
<--- -------------------------- -*/

  /* Mobile - 360px - Contains hover animation */
  @media only screen and (min-width: 0em) {
    #gallery {
      /* Centers button */
      text-align: center;
      padding: var(--sectionPadding);
      position: relative;
      /* Prevents overflow from the image going off screen */
      overflow: hidden;
      .cs-container {
        width: 100%;
        max-width: (1322/16em);
        margin: auto;
      }

      .cs-image-group {
        /* used rem so it doesn't scale with the font size of on parent */
        font-size: ~'min(1.1vw, 1em)';
        width: 100%;
        max-width: (1322/16em);
        margin: 0 auto (60/16rem);
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: (30/16em);
      }

      .cs-row {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        gap: (30/16em);
      }

      .cs-picture {
        display: block;
        position: relative;
        img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          left: 0;
        }
      }

      .cs-row-1 {
        .cs-picture1 {
          width: (420/16em);
          height: (567/16em);
        }

        .cs-picture2 {
          width: (420/16em);
          height: (629/16em);
        }

        .cs-picture3 {
          width: (420/16em);
          height: (512/16em);
        }
      }

      .cs-row-2 {
        .cs-picture1 {
          width: (420/16em);
          height: (492/16em);
        }

        .cs-picture2 {
          width: (420/16em);
          height: (517/16em);
        }

        .cs-picture3 {
          width: (420/16em);
          height: (629/16em);
        }
      }

      .cs-row-3 {
        .cs-picture1 {
          width: (420/16em);
          height: (625/16em);
        }

        .cs-picture2 {
          width: (420/16em);
          height: (452/16em);
        }

        .cs-picture3 {
          width: (420/16em);
          height: (629/16em);
        }
      }
    }
  }
</style>
